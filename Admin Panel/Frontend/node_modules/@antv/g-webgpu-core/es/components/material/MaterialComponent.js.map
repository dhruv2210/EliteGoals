{"version":3,"sources":["../../../src/components/material/MaterialComponent.ts"],"names":["gl","Component","MaterialComponent","data","vertexShaderGLSL","fragmentShaderGLSL","defines","dirty","uniforms","cull","enable","face","BACK","depth","blend","entity","type","Object","assign","name","keys","forEach","key","setUniform","existedUniform","find","u","push"],"mappings":";;;;;;;;;;;;;;;;AAAA,SAAiBA,EAAjB,QAA2B,OAA3B;AACA,SAASC,SAAT,QAA0B,wBAA1B;AAMA,WAAaC,iBAAb;AAAA;;AAAA;;AAKE;AAsBA,6BAAYC,IAAZ,EAAqE;AAAA;;AAAA;;AACnE,8BAAMA,IAAN;AADmE,UA1B9DC,gBA0B8D;AAAA,UAxB9DC,kBAwB8D;AAAA,UArB9DC,OAqB8D,GArBlB,EAqBkB;AAAA,UAnB9DC,KAmB8D,GAnBtD,IAmBsD;AAAA,UAjB9DC,QAiB8D,GAjBhC,EAiBgC;AAAA,UAf9DC,IAe8D,GAflB;AACjDC,MAAAA,MAAM,EAAE,IADyC;AAEjDC,MAAAA,IAAI,EAAEX,EAAE,CAACY;AAFwC,KAekB;AAAA,UAV9DC,KAU8D,GAVhB;AACnDH,MAAAA,MAAM,EAAE;AAD2C,KAUgB;AAAA,UAN9DI,KAM8D;AAAA,UAJ9DC,MAI8D;AAAA,UAF9DC,IAE8D;AAGnEC,IAAAA,MAAM,CAACC,MAAP,gCAAoBf,IAApB;AAHmE;AAIpE;;AA/BH;AAAA;AAAA,+BAiCoBG,OAjCpB,EAiC+D;AAC3D,WAAKA,OAAL,mCAAoB,KAAKA,OAAzB,GAAqCA,OAArC;AACA,aAAO,IAAP;AACD;AApCH;AAAA;AAAA,4BAsCiBG,IAtCjB,EAsC4D;AACxD,WAAKA,IAAL,GAAYA,IAAZ;AACA,aAAO,IAAP;AACD;AAzCH;AAAA;AAAA,6BA2CkBI,KA3ClB,EA2C+D;AAC3D,WAAKA,KAAL,GAAaA,KAAb;AACA,aAAO,IAAP;AACD;AA9CH;AAAA;AAAA,6BAgDkBC,KAhDlB,EAgD+D;AAC3D,WAAKA,KAAL,GAAaA,KAAb;AACA,aAAO,IAAP;AACD;AAnDH;AAAA;AAAA,+BAsDIK,IAtDJ,EAuDIhB,IAvDJ,EAwDI;AAAA;;AACA,UAAI,OAAOgB,IAAP,KAAgB,QAApB,EAA8B;AAC5BF,QAAAA,MAAM,CAACG,IAAP,CAAYD,IAAZ,EAAkBE,OAAlB,CAA0B,UAACC,GAAD;AAAA,iBAAS,MAAI,CAACC,UAAL,CAAgBD,GAAhB,EAAqBH,IAAI,CAACG,GAAD,CAAzB,CAAT;AAAA,SAA1B;AACA,eAAO,IAAP;AACD;;AAED,UAAME,cAAc,GAAG,KAAKhB,QAAL,CAAciB,IAAd,CAAmB,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACP,IAAF,KAAWA,IAAlB;AAAA,OAAnB,CAAvB;;AACA,UAAI,CAACK,cAAL,EAAqB;AACnB,aAAKhB,QAAL,CAAcmB,IAAd,CAAmB;AACjBR,UAAAA,IAAI,EAAJA,IADiB;AAEjBZ,UAAAA,KAAK,EAAE,IAFU;AAGjBJ,UAAAA,IAAI,EAAEA;AAHW,SAAnB;AAKD,OAND,MAMO;AACLqB,QAAAA,cAAc,CAACjB,KAAf,GAAuB,IAAvB;AACAiB,QAAAA,cAAc,CAACrB,IAAf,GAAsBA,IAAtB;AACD;;AAED,WAAKI,KAAL,GAAa,IAAb;AACA,aAAO,IAAP;AACD;AA5EH;;AAAA;AAAA,EAAuCN,SAAvC","sourcesContent":["import { Entity, gl } from '../..';\nimport { Component } from '../../ComponentManager';\nimport { NonFunctionProperties } from '../../ComponentManager';\nimport { IModelInitializationOptions } from '../renderer/IModel';\nimport { BufferData } from '../renderer/IRendererService';\nimport { IUniformBinding } from './interface';\n\nexport class MaterialComponent extends Component<MaterialComponent> {\n  public vertexShaderGLSL: string;\n\n  public fragmentShaderGLSL: string;\n\n  // control flow in shaders, eg. USE_UV, USE_MAP...\n  public defines: Record<string, boolean | number> = {};\n\n  public dirty = true;\n\n  public uniforms: IUniformBinding[] = [];\n\n  public cull: IModelInitializationOptions['cull'] = {\n    enable: true,\n    face: gl.BACK,\n  };\n\n  public depth: IModelInitializationOptions['depth'] = {\n    enable: true,\n  };\n\n  public blend: IModelInitializationOptions['blend'];\n\n  public entity: Entity;\n\n  public type: string;\n\n  constructor(data: Partial<NonFunctionProperties<MaterialComponent>>) {\n    super(data);\n\n    Object.assign(this, data);\n  }\n\n  public setDefines(defines: Record<string, boolean | number>) {\n    this.defines = { ...this.defines, ...defines };\n    return this;\n  }\n\n  public setCull(cull: IModelInitializationOptions['cull']) {\n    this.cull = cull;\n    return this;\n  }\n\n  public setDepth(depth: IModelInitializationOptions['depth']) {\n    this.depth = depth;\n    return this;\n  }\n\n  public setBlend(blend: IModelInitializationOptions['blend']) {\n    this.blend = blend;\n    return this;\n  }\n\n  public setUniform(\n    name: string | Record<string, BufferData>,\n    data?: BufferData,\n  ) {\n    if (typeof name !== 'string') {\n      Object.keys(name).forEach((key) => this.setUniform(key, name[key]));\n      return this;\n    }\n\n    const existedUniform = this.uniforms.find((u) => u.name === name);\n    if (!existedUniform) {\n      this.uniforms.push({\n        name,\n        dirty: true,\n        data: data!,\n      });\n    } else {\n      existedUniform.dirty = true;\n      existedUniform.data = data!;\n    }\n\n    this.dirty = true;\n    return this;\n  }\n}\n"],"file":"MaterialComponent.js"}