{"version":3,"sources":["../../../src/components/framegraph/PassNode.ts"],"names":["PassNode","name","refCount","hasSideEffect","devirtualize","destroy","reads","writes","handle","find","h","index","push","read","fg","existed","node","getResourceNode","resource","version","imported","r","createResourceNode","newNode","writer"],"mappings":";;;;;;;;;;;;;IAIaA,Q;;;SACJC,I;SAIAC,Q,GAAW,C;SAKXC,a,GAAgB,K;SAKhBC,Y,GAAkC,E;SAKlCC,O,GAA6B,E;SAE7BC,K,GAA4B,E;SAE5BC,M,GAA6B,E;;;;;yBAExBC,M,EAA4C;AACtD,UAAI,CAAC,KAAKF,KAAL,CAAWG,IAAX,CAAgB,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACC,KAAF,KAAYH,MAAM,CAACG,KAA1B;AAAA,OAAhB,CAAL,EAAuD;AACrD,aAAKL,KAAL,CAAWM,IAAX,CAAgBJ,MAAhB;AACD;;AACD,aAAOA,MAAP;AACD;;;2BAEaA,M,EAA0B;AACtC,WAAKK,IAAL,CAAUL,MAAV,EADsC,CAEtC;;AACA,aAAOA,MAAP;AACD;;;0BAGCM,E,EACAN,M,EACkB;AAClB,UAAMO,OAAO,GAAG,KAAKR,MAAL,CAAYE,IAAZ,CAAiB,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACC,KAAF,KAAYH,MAAM,CAACG,KAA1B;AAAA,OAAjB,CAAhB;;AACA,UAAII,OAAJ,EAAa;AACX,eAAOP,MAAP;AACD;;AAED,UAAMQ,IAAI,GAAGF,EAAE,CAACG,eAAH,CAAmBT,MAAnB,CAAb;AAEAQ,MAAAA,IAAI,CAACE,QAAL,CAAcC,OAAd;;AAEA,UAAIH,IAAI,CAACE,QAAL,CAAcE,QAAlB,EAA4B;AAC1B,aAAKjB,aAAL,GAAqB,IAArB;AACD;;AAED,UAAMkB,CAAC,GAAGP,EAAE,CAACQ,kBAAH,CAAsBN,IAAI,CAACE,QAA3B,CAAV;AACA,UAAMK,OAAO,GAAGT,EAAE,CAACG,eAAH,CAAmBI,CAAnB,CAAhB;AAEAE,MAAAA,OAAO,CAACC,MAAR,GAAiB,IAAjB;AAEA,WAAKjB,MAAL,CAAYK,IAAZ,CAAiBS,CAAjB;AACA,aAAOA,CAAP;AACD","sourcesContent":["import { FrameGraphHandle } from './FrameGraphHandle';\nimport { FrameGraphSystem } from './System';\nimport { VirtualResource } from './VirtualResource';\n\nexport class PassNode {\n  public name: string;\n  /**\n   * count resources that have a reference to this pass node\n   */\n  public refCount = 0;\n\n  /**\n   * set by FG system\n   */\n  public hasSideEffect = false;\n\n  /**\n   * during FG's compile, create before executing\n   */\n  public devirtualize: VirtualResource[] = [];\n\n  /**\n   * during FG's compile, destroy after executing\n   */\n  public destroy: VirtualResource[] = [];\n\n  public reads: FrameGraphHandle[] = [];\n\n  public writes: FrameGraphHandle[] = [];\n\n  public read(handle: FrameGraphHandle): FrameGraphHandle {\n    if (!this.reads.find((h) => h.index === handle.index)) {\n      this.reads.push(handle);\n    }\n    return handle;\n  }\n\n  public sample(handle: FrameGraphHandle) {\n    this.read(handle);\n    // TODO: 记录在 this.samples 中\n    return handle;\n  }\n\n  public write(\n    fg: FrameGraphSystem,\n    handle: FrameGraphHandle,\n  ): FrameGraphHandle {\n    const existed = this.writes.find((h) => h.index === handle.index);\n    if (existed) {\n      return handle;\n    }\n\n    const node = fg.getResourceNode(handle);\n\n    node.resource.version++;\n\n    if (node.resource.imported) {\n      this.hasSideEffect = true;\n    }\n\n    const r = fg.createResourceNode(node.resource);\n    const newNode = fg.getResourceNode(r);\n\n    newNode.writer = this;\n\n    this.writes.push(r);\n    return r;\n  }\n}\n"],"file":"PassNode.js"}