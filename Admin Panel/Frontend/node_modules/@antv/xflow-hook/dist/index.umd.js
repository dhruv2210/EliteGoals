!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).XFlowHook={})}(this,(function(e){"use strict";function t(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function h(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,h)}a((n=n.apply(e,t||[])).next())}))}var o;e.ScheduleTypeEnum=void 0,(o=e.ScheduleTypeEnum||(e.ScheduleTypeEnum={})).ASYNC_SRRIES="ASYNC_SRRIES",o.ASYNC_PARALLEL="ASYNC_PARALLEL";var n={exports:{}};function r(e,t){var o=e.length,n=new Array(o),r={},i=o,s=function(e){for(var t=new Map,o=0,n=e.length;o<n;o++){var r=e[o];t.has(r[0])||t.set(r[0],new Set),t.has(r[1])||t.set(r[1],new Set),t.get(r[0]).add(r[1])}return t}(t),h=function(e){for(var t=new Map,o=0,n=e.length;o<n;o++)t.set(e[o],o);return t}(e);for(t.forEach((function(e){if(!h.has(e[0])||!h.has(e[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")}));i--;)r[i]||a(e[i],i,new Set);return n;function a(e,t,i){if(i.has(e)){var c;try{c=", node was:"+JSON.stringify(e)}catch(e){c=""}throw new Error("Cyclic dependency"+c)}if(!h.has(e))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(e));if(!r[t]){r[t]=!0;var u=s.get(e)||new Set;if(t=(u=Array.from(u)).length){i.add(e);do{var l=u[--t];a(l,h.get(l),i)}while(t);i.delete(e)}n[--o]=e}}}n.exports=function(e){return r(function(e){for(var t=new Set,o=0,n=e.length;o<n;o++){var r=e[o];t.add(r[0]),t.add(r[1])}return Array.from(t)}(e),e)},n.exports.array=r;var i,s,h=n.exports;!function(e){let t;!function(e){e.INVALID_HOOK_BEFORE="INVALID_HOOK_BEFORE",e.INVALID_HOOK_AFTER="INVALID_HOOK_AFTER",e.INVALID_HOOK_ARGS_LENGTH="INVALID_HOOK_ARGS_LENGTH"}(t=e.ErrorEnum||(e.ErrorEnum={}));class o extends Error{constructor(e,t,...n){Array.isArray(t)&&(t=t.filter((function(e){return!!e})).join(" ")),super(`${e}: ${t}`),Error.captureStackTrace&&Error.captureStackTrace(this,o),this.code=e,this.contexts={},n.forEach((e=>{"object"==typeof e&&Object.entries(e).forEach((e=>{const[t,o]=e;"key"!==t&&o&&(this.contexts[t]=JSON.parse(JSON.stringify(o)))}))}))}toString(){return`${this.code}: ${this.message}`}}e.HookError=o;const n=(e,t,...n)=>new o(e,t,...n);e.HookBeforeError=()=>n(t.INVALID_HOOK_BEFORE,["hook require a before dependency but not exist in hookmap"]),e.HookAfterError=()=>n(t.INVALID_HOOK_AFTER,["hook require a after dependency but not exist in hookmap"]),e.InvalidHookArguments=e=>n(t.INVALID_HOOK_ARGS_LENGTH,["hook handlers must have 0 to 2 arguments",`but got ${e.handler.length}`])}(i||(i={})),function(e){e.normalize=(e=[],t)=>{const o=Array.isArray(e)?e:[e],n=[];return t.forEach((e=>{n.push(e)})),[...n,...o].filter((e=>e&&!!e.handler))},e.sort=(e=[],t)=>{const o=[];e.forEach((e=>{if(e.before){if(!t.has(e.before))throw i.HookBeforeError();const n=[e,t.get(e.before)];o.push(n)}if(e.after){if(!t.has(e.after))throw i.HookBeforeError();const n=[t.get(e.after),e];o.push(n)}}));return h.array(e,o)}}(s||(s={}));class a{constructor(){this.isResolved=!1,this.isRejected=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>{this.isResolved=!0,e(t)},this.reject=e=>{this.isRejected=!0,t(e)}}))}}e.HookHub=class{constructor(o){this.scheduleType=e.ScheduleTypeEnum.ASYNC_SRRIES,this.hasHook=e=>this.hookMap.has(e),this.getHooks=(e=[],t=!0)=>{const o=s.normalize(e,this.hookMap);return t?s.sort(o,this.hookMap):o},this.registerHook=e=>(this.hookMap.has(e.name)&&console.error(`${e.name} is duplicated in hookmap`),this.hookMap.set(e.name,e),{dispose:()=>{this.hookMap.delete(e.name)}}),this.call=(e,o=(e=>t(this,void 0,void 0,(function*(){return e}))),n=[])=>t(this,void 0,void 0,(function*(){const t=this.getHooks(n,!0);return(0,this.schedulers[this.scheduleType])(e,o,t)})),this.schedulers={[e.ScheduleTypeEnum.ASYNC_SRRIES]:(e,o,n=[])=>t(this,void 0,void 0,(function*(){let t=o;for(const o of n){if([0,1].includes(o.handler.length)){yield o.handler.call(this,e);continue}if([2].includes(o.handler.length)&&null!==t){const n=yield o.handler.call(this,e,t);if(null===n){t=null;break}if("function"==typeof n){t=n;continue}}throw i.InvalidHookArguments(o)}if(t)return yield t.call(this,e)})),[e.ScheduleTypeEnum.ASYNC_PARALLEL]:(e,o,n=[])=>t(this,void 0,void 0,(function*(){const t=n.map((t=>{if([0,1].includes(t.handler.length))return t.handler.call(this,e);if([2].includes(t.handler.length))return t.handler.call(this,e,o);throw i.InvalidHookArguments(t)})),r=new a;if(Promise.all(t).then((e=>r.resolve(e))),o)return yield o.call(this,r)}))},this.hookMap=new Map,o&&o.type&&(this.scheduleType=o.type)}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
