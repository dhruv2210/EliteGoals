{"ast":null,"code":"import { Util } from '@antv/g2';\nimport { get, isEmpty, isFunction, reduce } from '@antv/util';\nimport { deepAssign, findGeometry } from '../../../utils';\nimport { isLine } from './option';\n/**\n * 获取 view 的 legendItem，供存在不含有 seriesField 的图形使用\n * @param params\n */\nexport function getViewLegendItems(params) {\n  var view = params.view,\n    geometryOption = params.geometryOption,\n    yField = params.yField,\n    legend = params.legend;\n  var userMarker = get(legend, 'marker');\n  var geometry = findGeometry(view, isLine(geometryOption) ? 'line' : 'interval');\n  if (!geometryOption.seriesField) {\n    var legendItemName = get(view, \"options.scales.\" + yField + \".alias\") || yField;\n    // 返回 g2 设置的图例\n    var colorAttribute = geometry.getAttribute('color');\n    var color = view.getTheme().defaultColor;\n    if (colorAttribute) {\n      color = Util.getMappingValue(colorAttribute, legendItemName, get(colorAttribute, ['values', 0], color));\n    }\n    var marker = (isFunction(userMarker) ? userMarker : !isEmpty(userMarker) && deepAssign({}, {\n      style: {\n        stroke: color,\n        fill: color\n      }\n    }, userMarker)) || (isLine(geometryOption) ? {\n      symbol: function symbol(x, y, r) {\n        return [['M', x - r, y], ['L', x + r, y]];\n      },\n      style: {\n        lineWidth: 2,\n        r: 6,\n        stroke: color\n      }\n    } : {\n      symbol: 'square',\n      style: {\n        fill: color\n      }\n    });\n    return [{\n      value: yField,\n      name: legendItemName,\n      marker: marker,\n      isGeometry: true,\n      viewId: view.id\n    }];\n  }\n  var attributes = geometry.getGroupAttributes();\n  return reduce(attributes, function (items, attr) {\n    var attrItems = Util.getLegendItems(view, geometry, attr, view.getTheme(), userMarker);\n    return items.concat(attrItems);\n  }, []);\n}","map":null,"metadata":{},"sourceType":"module"}