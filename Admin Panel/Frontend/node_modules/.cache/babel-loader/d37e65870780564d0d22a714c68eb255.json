{"ast":null,"code":"/**\n * 获取分类字段 key 值 一个分类值的时候， 返回非索引 key 值，在 tooltip 不做索引区分\n * @param values 数据量\n * @param field 指标字段\n * @param index 索引\n * @returns string\n */\nfunction getSeriesFieldKey(values, field, index) {\n  return values.length > 1 ? field + \"_\" + index : \"\" + field;\n}\n/**\n * bullet 处理数据\n * @param options\n */\nexport function transformData(options) {\n  var data = options.data,\n    xField = options.xField,\n    measureField = options.measureField,\n    rangeField = options.rangeField,\n    targetField = options.targetField,\n    layout = options.layout;\n  var ds = [];\n  var scales = [];\n  data.forEach(function (item, index) {\n    // 构建 title * range\n    var rangeValues = [item[rangeField]].flat();\n    rangeValues.sort(function (a, b) {\n      return a - b;\n    });\n    rangeValues.forEach(function (d, i) {\n      var _a;\n      var range = i === 0 ? d : rangeValues[i] - rangeValues[i - 1];\n      ds.push((_a = {\n        rKey: rangeField + \"_\" + i\n      }, _a[xField] = xField ? item[xField] : String(index), _a[rangeField] = range, _a));\n    });\n    // 构建 title * measure\n    var measureValues = [item[measureField]].flat();\n    measureValues.forEach(function (d, i) {\n      var _a;\n      ds.push((_a = {\n        mKey: getSeriesFieldKey(measureValues, measureField, i)\n      }, _a[xField] = xField ? item[xField] : String(index), _a[measureField] = d, _a));\n    });\n    // 构建 title * target\n    var targetValues = [item[targetField]].flat();\n    targetValues.forEach(function (d, i) {\n      var _a;\n      ds.push((_a = {\n        tKey: getSeriesFieldKey(targetValues, targetField, i)\n      }, _a[xField] = xField ? item[xField] : String(index), _a[targetField] = d, _a));\n    });\n    // 为了取最大值和最小值，先存储\n    scales.push(item[rangeField], item[measureField], item[targetField]);\n  });\n  // scales 是嵌套的需要拍平\n  var min = Math.min.apply(Math, scales.flat(Infinity));\n  var max = Math.max.apply(Math, scales.flat(Infinity));\n  // min 大于 0 从 0 开始\n  min = min > 0 ? 0 : min;\n  // 垂直情况，需要反转数据\n  if (layout === 'vertical') {\n    ds.reverse();\n  }\n  return {\n    min: min,\n    max: max,\n    ds: ds\n  };\n}","map":null,"metadata":{},"sourceType":"module"}