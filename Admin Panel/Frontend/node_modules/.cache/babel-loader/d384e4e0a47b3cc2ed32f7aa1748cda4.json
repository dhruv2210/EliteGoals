{"ast":null,"code":"import { __assign, __extends, __rest } from \"tslib\";\nimport { clamp, deepMix, each, filter, get, mix, isNumber, isFunction } from '@antv/util';\nimport { ellipsisLabel } from '../util/label';\nimport { getMatrixByAngle, getMatrixByTranslate } from '../util/matrix';\nimport { getStatesStyle } from '../util/state';\nimport Theme from '../util/theme';\nimport LegendBase from './base';\n/**\n * 分页器 默认配置\n */\nvar DEFAULT_PAGE_NAVIGATOR = {\n  marker: {\n    style: {\n      inactiveFill: '#000',\n      inactiveOpacity: 0.45,\n      fill: '#000',\n      opacity: 1,\n      size: 12\n    }\n  },\n  text: {\n    style: {\n      fill: '#ccc',\n      fontSize: 12\n    }\n  }\n};\n// 默认 文本style\nvar textStyle = {\n  fill: Theme.textColor,\n  fontSize: 12,\n  textAlign: 'start',\n  textBaseline: 'middle',\n  fontFamily: Theme.fontFamily,\n  fontWeight: 'normal',\n  lineHeight: 12\n};\nvar RIGHT_ARROW_NAME = 'navigation-arrow-right';\nvar LEFT_ARROW_NAME = 'navigation-arrow-left';\nvar ROTATE_MAP = {\n  right: 90 * Math.PI / 180,\n  left: (360 - 90) * Math.PI / 180,\n  up: 0,\n  down: 180 * Math.PI / 180\n};\nvar Category = /** @class */function (_super) {\n  __extends(Category, _super);\n  function Category() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.currentPageIndex = 1;\n    _this.totalPagesCnt = 1;\n    _this.pageWidth = 0;\n    _this.pageHeight = 0;\n    _this.startX = 0;\n    _this.startY = 0;\n    _this.onNavigationBack = function () {\n      var itemGroup = _this.getElementByLocalId('item-group');\n      if (_this.currentPageIndex > 1) {\n        _this.currentPageIndex -= 1;\n        _this.updateNavigation();\n        var matrix = _this.getCurrentNavigationMatrix();\n        if (_this.get('animate')) {\n          itemGroup.animate({\n            matrix: matrix\n          }, 100);\n        } else {\n          itemGroup.attr({\n            matrix: matrix\n          });\n        }\n      }\n    };\n    _this.onNavigationAfter = function () {\n      var itemGroup = _this.getElementByLocalId('item-group');\n      if (_this.currentPageIndex < _this.totalPagesCnt) {\n        _this.currentPageIndex += 1;\n        _this.updateNavigation();\n        var matrix = _this.getCurrentNavigationMatrix();\n        if (_this.get('animate')) {\n          itemGroup.animate({\n            matrix: matrix\n          }, 100);\n        } else {\n          itemGroup.attr({\n            matrix: matrix\n          });\n        }\n      }\n    };\n    return _this;\n  }\n  Category.prototype.getDefaultCfg = function () {\n    var cfg = _super.prototype.getDefaultCfg.call(this);\n    return __assign(__assign({}, cfg), {\n      name: 'legend',\n      type: 'category',\n      itemSpacing: 24,\n      itemMarginBottom: 8,\n      maxItemWidth: null,\n      itemWidth: null,\n      itemHeight: null,\n      itemName: {},\n      itemValue: null,\n      maxWidth: null,\n      maxHeight: null,\n      marker: {},\n      radio: null,\n      items: [],\n      itemStates: {},\n      itemBackground: {},\n      pageNavigator: {},\n      defaultCfg: {\n        title: {\n          spacing: 5,\n          style: {\n            fill: Theme.textColor,\n            fontSize: 12,\n            textAlign: 'start',\n            textBaseline: 'top'\n          }\n        },\n        background: {\n          padding: 5,\n          style: {\n            stroke: Theme.lineColor\n          }\n        },\n        itemBackground: {\n          style: {\n            opacity: 0,\n            fill: '#fff'\n          }\n        },\n        pageNavigator: DEFAULT_PAGE_NAVIGATOR,\n        itemName: {\n          spacing: 16,\n          style: textStyle\n        },\n        marker: {\n          spacing: 8,\n          style: {\n            r: 6,\n            symbol: 'circle'\n          }\n        },\n        itemValue: {\n          alignRight: false,\n          formatter: null,\n          style: textStyle,\n          spacing: 6\n        },\n        itemStates: {\n          active: {\n            nameStyle: {\n              opacity: 0.8\n            }\n          },\n          unchecked: {\n            nameStyle: {\n              fill: Theme.uncheckedColor\n            },\n            markerStyle: {\n              fill: Theme.uncheckedColor,\n              stroke: Theme.uncheckedColor\n            }\n          },\n          inactive: {\n            nameStyle: {\n              fill: Theme.uncheckedColor\n            },\n            markerStyle: {\n              opacity: 0.2\n            }\n          }\n        }\n      }\n    });\n  };\n  // 实现 IList 接口\n  Category.prototype.isList = function () {\n    return true;\n  };\n  /**\n   * 获取图例项\n   * @return {ListItem[]} 列表项集合\n   */\n  Category.prototype.getItems = function () {\n    return this.get('items');\n  };\n  /**\n   * 设置列表项\n   * @param {ListItem[]} items 列表项集合\n   */\n  Category.prototype.setItems = function (items) {\n    this.update({\n      items: items\n    });\n  };\n  /**\n   * 更新列表项\n   * @param {ListItem} item 列表项\n   * @param {object}   cfg  列表项\n   */\n  Category.prototype.updateItem = function (item, cfg) {\n    mix(item, cfg);\n    this.clear(); // 由于单个图例项变化，会引起全局变化，所以全部更新\n    this.render();\n  };\n  /**\n   * 清空列表\n   */\n  Category.prototype.clearItems = function () {\n    var itemGroup = this.getElementByLocalId('item-group');\n    itemGroup && itemGroup.clear();\n  };\n  /**\n   * 设置列表项的状态\n   * @param {ListItem} item  列表项\n   * @param {string}   state 状态名\n   * @param {boolean}  value 状态值, true, false\n   */\n  Category.prototype.setItemState = function (item, state, value) {\n    item[state] = value;\n    var itemElement = this.getElementByLocalId(\"item-\" + item.id);\n    if (itemElement) {\n      var items = this.getItems();\n      var index = items.indexOf(item);\n      var offsetGroup = this.createOffScreenGroup(); // 离屏的 group\n      var newElement = this.drawItem(item, index, this.getItemHeight(), offsetGroup);\n      this.updateElements(newElement, itemElement); // 更新整个分组\n      this.clearUpdateStatus(itemElement); // 清理更新状态，防止出现 bug\n    }\n  };\n  /**\n   * 是否存在指定的状态\n   * @param {ListItem} item  列表项\n   * @param {boolean} state 状态名\n   */\n  Category.prototype.hasState = function (item, state) {\n    return !!item[state];\n  };\n  Category.prototype.getItemStates = function (item) {\n    var itemStates = this.get('itemStates');\n    var rst = [];\n    each(itemStates, function (v, k) {\n      if (item[k]) {\n        // item.selected\n        rst.push(k);\n      }\n    });\n    return rst;\n  };\n  /**\n   * 清楚所有列表项的状态\n   * @param {string} state 状态值\n   */\n  Category.prototype.clearItemsState = function (state) {\n    var _this = this;\n    var items = this.getItemsByState(state);\n    each(items, function (item) {\n      _this.setItemState(item, state, false);\n    });\n  };\n  /**\n   * 根据状态获取图例项\n   * @param  {string}     state [description]\n   * @return {ListItem[]}       [description]\n   */\n  Category.prototype.getItemsByState = function (state) {\n    var _this = this;\n    var items = this.getItems();\n    return filter(items, function (item) {\n      return _this.hasState(item, state);\n    });\n  };\n  // 绘制 legend 的选项\n  Category.prototype.drawLegendContent = function (group) {\n    this.processItems();\n    this.drawItems(group);\n  };\n  // 防止未设置 id\n  Category.prototype.processItems = function () {\n    var items = this.get('items');\n    each(items, function (item) {\n      if (!item.id) {\n        // 如果没有设置 id，默认使用 name\n        item.id = item.name;\n      }\n    });\n  };\n  // 绘制所有的图例选项\n  Category.prototype.drawItems = function (group) {\n    var _this = this;\n    var itemContainerGroup = this.addGroup(group, {\n      id: this.getElementId('item-container-group'),\n      name: 'legend-item-container-group'\n    });\n    var itemGroup = this.addGroup(itemContainerGroup, {\n      id: this.getElementId('item-group'),\n      name: 'legend-item-group'\n    });\n    var itemHeight = this.getItemHeight();\n    var itemWidth = this.get('itemWidth');\n    var itemSpacing = this.get('itemSpacing');\n    var itemMarginBottom = this.get('itemMarginBottom');\n    var currentPoint = this.get('currentPoint');\n    var startX = currentPoint.x;\n    var startY = currentPoint.y;\n    var layout = this.get('layout');\n    var items = this.get('items');\n    var wrapped = false;\n    var pageWidth = 0;\n    var maxWidth = this.get('maxWidth'); // 最大宽度，会导致 layout : 'horizontal' 时自动换行\n    var maxHeight = this.get('maxHeight'); // 最大高度，会导致出现分页\n    // 暂时不考虑分页\n    each(items, function (item, index) {\n      var subGroup = _this.drawItem(item, index, itemHeight, itemGroup);\n      var bbox = subGroup.getBBox();\n      var width = itemWidth || bbox.width;\n      if (width > pageWidth) {\n        pageWidth = width;\n      }\n      if (layout === 'horizontal') {\n        // 如果水平布局\n        if (maxWidth && maxWidth < currentPoint.x + width - startX) {\n          // 检测是否换行\n          wrapped = true;\n          currentPoint.x = startX;\n          currentPoint.y += itemHeight + itemMarginBottom;\n        }\n        _this.moveElementTo(subGroup, currentPoint);\n        currentPoint.x += width + itemSpacing;\n      } else {\n        // 如果垂直布局\n        if (maxHeight && maxHeight < currentPoint.y + itemHeight + itemMarginBottom - startY) {\n          // 换行\n          wrapped = true;\n          currentPoint.x += pageWidth + itemSpacing;\n          currentPoint.y = startY;\n          pageWidth = 0;\n        }\n        _this.moveElementTo(subGroup, currentPoint);\n        currentPoint.y += itemHeight + itemMarginBottom; // itemSpacing 仅影响水平间距\n      }\n    });\n\n    if (wrapped && this.get('flipPage')) {\n      this.pageHeight = 0;\n      this.pageWidth = 0;\n      this.totalPagesCnt = 1;\n      this.startX = startX;\n      this.startY = startY;\n      this.adjustNavigation(group, itemGroup);\n    }\n  };\n  // 获取图例项的高度，如果未定义，则按照 name 的高度计算\n  Category.prototype.getItemHeight = function () {\n    var itemHeight = this.get('itemHeight');\n    if (!itemHeight) {\n      var style_1 = (this.get('itemName') || {}).style;\n      if (isFunction(style_1)) {\n        var items_1 = this.getItems();\n        items_1.forEach(function (item, index) {\n          var fontSize = __assign(__assign({}, textStyle), style_1(item, index, items_1)).fontSize;\n          if (itemHeight < fontSize) {\n            itemHeight = fontSize;\n          }\n        });\n      } else if (style_1) {\n        itemHeight = style_1.fontSize;\n      }\n    }\n    return itemHeight;\n  };\n  // 绘制 marker\n  Category.prototype.drawMarker = function (container, markerCfg, item, itemHeight) {\n    var markerAttrs = __assign(__assign(__assign({\n      x: 0,\n      y: itemHeight / 2\n    }, markerCfg.style), {\n      symbol: get(item.marker, 'symbol', 'circle')\n    }), get(item.marker, 'style', {}));\n    var shape = this.addShape(container, {\n      type: 'marker',\n      id: this.getElementId(\"item-\" + item.id + \"-marker\"),\n      name: 'legend-item-marker',\n      attrs: markerAttrs\n    });\n    var bbox = shape.getBBox();\n    shape.attr('x', bbox.width / 2); // marker 需要左对齐，所以不能占用左侧的空间\n    var _a = shape.attr(),\n      stroke = _a.stroke,\n      fill = _a.fill;\n    if (stroke) {\n      shape.set('isStroke', true);\n    }\n    if (fill) {\n      shape.set('isFill', true);\n    }\n    return shape;\n  };\n  // 绘制文本\n  Category.prototype.drawItemText = function (container, textName, cfg, item, itemHeight, xPosition, index) {\n    var formatter = cfg.formatter;\n    var style = cfg.style;\n    var attrs = __assign(__assign({\n      x: xPosition,\n      y: itemHeight / 2,\n      text: formatter ? formatter(item[textName], item, index) : item[textName]\n    }, textStyle), isFunction(style) ? style(item, index, this.getItems()) : style);\n    return this.addShape(container, {\n      type: 'text',\n      id: this.getElementId(\"item-\" + item.id + \"-\" + textName),\n      name: \"legend-item-\" + textName,\n      attrs: attrs\n    });\n  };\n  Category.prototype.drawRadio = function (container, radioCfg, item, itemHeight, x) {\n    var _a, _b;\n    var style = radioCfg.style || {};\n    // 以用户设置的 r 为主\n    var r = (_a = style.r) !== null && _a !== void 0 ? _a : itemHeight / 2;\n    var lineWidth = r * 3.6 / 8;\n    var _c = [x + r, itemHeight / 2 - r],\n      x0 = _c[0],\n      y0 = _c[1];\n    var _d = [x0 + r, y0 + r],\n      x1 = _d[0],\n      y1 = _d[1];\n    var _e = [x0, y1 + r],\n      x2 = _e[0],\n      y2 = _e[1];\n    var _f = [x, y0 + r],\n      x3 = _f[0],\n      y3 = _f[1];\n    var showRadio = item.showRadio;\n    var attrs = __assign(__assign({\n      path: [['M', x0, y0], ['A', r, r, 0, 0, 1, x1, y1], ['L', x1 - lineWidth, y1], ['L', x1, y1], ['A', r, r, 0, 0, 1, x2, y2], ['L', x2, y2 - lineWidth], ['L', x2, y2], ['A', r, r, 0, 0, 1, x3, y3], ['L', x3 + lineWidth, y3], ['L', x3, y3], ['A', r, r, 0, 0, 1, x0, y0], ['L', x0, y0 + lineWidth]],\n      stroke: '#000000',\n      fill: '#ffffff'\n    }, style), {\n      opacity: showRadio ? (_b = style === null || style === void 0 ? void 0 : style.opacity) !== null && _b !== void 0 ? _b : 0.45 : 0\n    });\n    var radioShape = this.addShape(container, {\n      type: 'path',\n      id: this.getElementId(\"item-\" + item.id + \"-radio\"),\n      name: 'legend-item-radio',\n      attrs: attrs\n    });\n    radioShape.set('tip', radioCfg.tip);\n    return radioShape;\n  };\n  // 绘制图例项\n  Category.prototype.drawItem = function (item, index, itemHeight, itemGroup) {\n    var groupId = \"item-\" + item.id;\n    // 设置单独的 Group 用于 setClip\n    var subContainer = this.addGroup(itemGroup, {\n      name: 'legend-item-container',\n      id: this.getElementId(\"item-container-\" + groupId),\n      delegateObject: {\n        item: item,\n        index: index\n      }\n    });\n    var subGroup = this.addGroup(subContainer, {\n      name: 'legend-item',\n      id: this.getElementId(groupId),\n      delegateObject: {\n        item: item,\n        index: index\n      }\n    });\n    var marker = this.get('marker');\n    var itemName = this.get('itemName');\n    var itemValue = this.get('itemValue');\n    var itemBackground = this.get('itemBackground');\n    var radio = this.get('radio');\n    var itemWidth = this.getLimitItemWidth();\n    var curX = 0; // 记录当前 x 的位置\n    if (marker) {\n      var markerShape = this.drawMarker(subGroup, marker, item, itemHeight);\n      var spacing = marker.spacing;\n      var itemMarkerSpacing = get(item, ['marker', 'spacing']);\n      if (isNumber(itemMarkerSpacing)) {\n        // 如果 item 有配置 marker.spacing，采用 item 的配置\n        spacing = itemMarkerSpacing;\n      }\n      curX = markerShape.getBBox().maxX + spacing;\n    }\n    if (itemName) {\n      var nameShape = this.drawItemText(subGroup, 'name', itemName, item, itemHeight, curX, index);\n      if (itemWidth) {\n        // 设置了 item 的最大宽度限制，并且超出了，进行省略处理\n        ellipsisLabel(true, nameShape, clamp(itemWidth - curX, 0, itemWidth));\n      }\n      curX = nameShape.getBBox().maxX + itemName.spacing;\n    }\n    if (itemValue) {\n      var valueShape = this.drawItemText(subGroup, 'value', itemValue, item, itemHeight, curX, index);\n      if (itemWidth) {\n        if (itemValue.alignRight) {\n          valueShape.attr({\n            textAlign: 'right',\n            x: itemWidth\n          });\n          ellipsisLabel(true, valueShape, clamp(itemWidth - curX, 0, itemWidth), 'head');\n        } else {\n          ellipsisLabel(true, valueShape, clamp(itemWidth - curX, 0, itemWidth));\n        }\n      }\n      curX = valueShape.getBBox().maxX + itemValue.spacing;\n    }\n    if (radio) {\n      this.drawRadio(subGroup, radio, item, itemHeight, curX);\n    }\n    // 添加透明的背景，便于拾取和包围盒计算\n    if (itemBackground) {\n      var bbox = subGroup.getBBox();\n      var backShape = this.addShape(subGroup, {\n        type: 'rect',\n        name: 'legend-item-background',\n        id: this.getElementId(groupId + \"-background\"),\n        attrs: __assign({\n          x: 0,\n          y: 0,\n          width: bbox.width,\n          height: itemHeight\n        }, itemBackground.style)\n      });\n      backShape.toBack();\n    }\n    this.applyItemStates(item, subGroup);\n    return subGroup;\n  };\n  // 加上分页器并重新排序 items\n  Category.prototype.adjustNavigation = function (container, itemGroup) {\n    var _this = this;\n    var startX = this.startX;\n    var startY = this.startY;\n    var layout = this.get('layout');\n    var subGroups = itemGroup.findAll(function (item) {\n      return item.get('name') === 'legend-item';\n    });\n    var maxWidth = this.get('maxWidth');\n    var maxHeight = this.get('maxHeight');\n    var itemWidth = this.get('itemWidth');\n    var itemSpacing = this.get('itemSpacing');\n    var itemHeight = this.getItemHeight();\n    var pageNavigator = deepMix({}, DEFAULT_PAGE_NAVIGATOR, this.get('pageNavigator'));\n    var navigation = this.drawNavigation(container, layout, '00/00', pageNavigator);\n    var navigationBBox = navigation.getBBox();\n    var currentPoint = {\n      x: startX,\n      y: startY\n    };\n    var pages = 1;\n    var widthLimit = 0;\n    var pageWidth = 0;\n    var maxItemWidth = 0;\n    var itemMarginBottom = this.get('itemMarginBottom');\n    if (layout === 'horizontal') {\n      var maxRow = this.get('maxRow') || 1;\n      var maxRowHeight_1 = itemHeight + (maxRow === 1 ? 0 : itemMarginBottom);\n      this.pageHeight = maxRowHeight_1 * maxRow;\n      each(subGroups, function (item) {\n        var bbox = item.getBBox();\n        var width = itemWidth || bbox.width;\n        if (widthLimit && widthLimit < currentPoint.x + width + itemSpacing || maxWidth < currentPoint.x + width + itemSpacing + navigationBBox.width) {\n          if (pages === 1) {\n            widthLimit = currentPoint.x + itemSpacing;\n            _this.pageWidth = widthLimit;\n            _this.moveElementTo(navigation, {\n              x: maxWidth - itemSpacing - navigationBBox.width - navigationBBox.minX,\n              y: currentPoint.y + itemHeight / 2 - navigationBBox.height / 2 - navigationBBox.minY\n            });\n          }\n          pages += 1;\n          currentPoint.x = startX;\n          currentPoint.y += maxRowHeight_1;\n        }\n        _this.moveElementTo(item, currentPoint);\n        item.getParent().setClip({\n          type: 'rect',\n          attrs: {\n            x: currentPoint.x,\n            y: currentPoint.y,\n            width: width + itemSpacing,\n            height: itemHeight\n          }\n        });\n        currentPoint.x += width + itemSpacing;\n      });\n    } else {\n      each(subGroups, function (item) {\n        var bbox = item.getBBox();\n        if (bbox.width > pageWidth) {\n          pageWidth = bbox.width;\n        }\n      });\n      maxItemWidth = pageWidth;\n      pageWidth += itemSpacing;\n      if (maxWidth) {\n        // maxWidth 限制加上\n        pageWidth = Math.min(maxWidth, pageWidth);\n        maxItemWidth = Math.min(maxWidth, maxItemWidth);\n      }\n      this.pageWidth = pageWidth;\n      this.pageHeight = maxHeight - Math.max(navigationBBox.height, itemHeight + itemMarginBottom);\n      var cntPerPage_1 = Math.floor(this.pageHeight / (itemHeight + itemMarginBottom));\n      each(subGroups, function (item, index) {\n        if (index !== 0 && index % cntPerPage_1 === 0) {\n          pages += 1;\n          currentPoint.x += pageWidth;\n          currentPoint.y = startY;\n        }\n        _this.moveElementTo(item, currentPoint);\n        item.getParent().setClip({\n          type: 'rect',\n          attrs: {\n            x: currentPoint.x,\n            y: currentPoint.y,\n            width: pageWidth,\n            height: itemHeight\n          }\n        });\n        currentPoint.y += itemHeight + itemMarginBottom;\n      });\n      this.totalPagesCnt = pages;\n      this.moveElementTo(navigation, {\n        x: startX + maxItemWidth / 2 - navigationBBox.width / 2 - navigationBBox.minX,\n        y: maxHeight - navigationBBox.height - navigationBBox.minY\n      });\n    }\n    if (this.pageHeight && this.pageWidth) {\n      // 为了使固定的 clip 生效，clip 设置在 itemContainerGroup 上，itemGroup 需要在翻页时会设置 matrix\n      itemGroup.getParent().setClip({\n        type: 'rect',\n        attrs: {\n          x: this.startX,\n          y: this.startY,\n          width: this.pageWidth,\n          height: this.pageHeight\n        }\n      });\n    }\n    // 重新计算 totalPagesCnt\n    if (layout === 'horizontal' && this.get('maxRow')) {\n      this.totalPagesCnt = Math.ceil(pages / this.get('maxRow'));\n    } else {\n      this.totalPagesCnt = pages;\n    }\n    if (this.currentPageIndex > this.totalPagesCnt) {\n      this.currentPageIndex = 1;\n    }\n    this.updateNavigation(navigation);\n    // update initial matrix\n    itemGroup.attr('matrix', this.getCurrentNavigationMatrix());\n  };\n  /**\n   * 绘制分页器\n   */\n  Category.prototype.drawNavigation = function (group, layout, text, styleCfg) {\n    var currentPoint = {\n      x: 0,\n      y: 0\n    };\n    var subGroup = this.addGroup(group, {\n      id: this.getElementId('navigation-group'),\n      name: 'legend-navigation'\n    });\n    var _a = get(styleCfg.marker, 'style', {}),\n      _b = _a.size,\n      size = _b === void 0 ? 12 : _b,\n      arrowStyle = __rest(_a, [\"size\"]);\n    var leftArrow = this.drawArrow(subGroup, currentPoint, LEFT_ARROW_NAME, layout === 'horizontal' ? 'up' : 'left', size, arrowStyle);\n    leftArrow.on('click', this.onNavigationBack);\n    var leftArrowBBox = leftArrow.getBBox();\n    currentPoint.x += leftArrowBBox.width + 2;\n    var textShape = this.addShape(subGroup, {\n      type: 'text',\n      id: this.getElementId('navigation-text'),\n      name: 'navigation-text',\n      attrs: __assign({\n        x: currentPoint.x,\n        y: currentPoint.y + size / 2,\n        text: text,\n        textBaseline: 'middle'\n      }, get(styleCfg.text, 'style'))\n    });\n    var textBBox = textShape.getBBox();\n    currentPoint.x += textBBox.width + 2;\n    var rightArrow = this.drawArrow(subGroup, currentPoint, RIGHT_ARROW_NAME, layout === 'horizontal' ? 'down' : 'right', size, arrowStyle);\n    rightArrow.on('click', this.onNavigationAfter);\n    return subGroup;\n  };\n  Category.prototype.updateNavigation = function (navigation) {\n    var pageNavigator = deepMix({}, DEFAULT_PAGE_NAVIGATOR, this.get('pageNavigator'));\n    var _a = pageNavigator.marker.style,\n      fill = _a.fill,\n      opacity = _a.opacity,\n      inactiveFill = _a.inactiveFill,\n      inactiveOpacity = _a.inactiveOpacity;\n    var text = this.currentPageIndex + \"/\" + this.totalPagesCnt;\n    var textShape = navigation ? navigation.getChildren()[1] : this.getElementByLocalId('navigation-text');\n    var leftArrow = navigation ? navigation.findById(this.getElementId(LEFT_ARROW_NAME)) : this.getElementByLocalId(LEFT_ARROW_NAME);\n    var rightArrow = navigation ? navigation.findById(this.getElementId(RIGHT_ARROW_NAME)) : this.getElementByLocalId(RIGHT_ARROW_NAME);\n    textShape.attr('text', text);\n    // 更新 left-arrow marker\n    leftArrow.attr('opacity', this.currentPageIndex === 1 ? inactiveOpacity : opacity);\n    leftArrow.attr('fill', this.currentPageIndex === 1 ? inactiveFill : fill);\n    leftArrow.attr('cursor', this.currentPageIndex === 1 ? 'not-allowed' : 'pointer');\n    // 更新 right-arrow marker\n    rightArrow.attr('opacity', this.currentPageIndex === this.totalPagesCnt ? inactiveOpacity : opacity);\n    rightArrow.attr('fill', this.currentPageIndex === this.totalPagesCnt ? inactiveFill : fill);\n    rightArrow.attr('cursor', this.currentPageIndex === this.totalPagesCnt ? 'not-allowed' : 'pointer');\n    // 更新位置\n    var cursorX = leftArrow.getBBox().maxX + 2;\n    textShape.attr('x', cursorX);\n    cursorX += textShape.getBBox().width + 2;\n    this.updateArrowPath(rightArrow, {\n      x: cursorX,\n      y: 0\n    });\n  };\n  Category.prototype.drawArrow = function (group, currentPoint, name, direction, size, style) {\n    var x = currentPoint.x,\n      y = currentPoint.y;\n    var shape = this.addShape(group, {\n      type: 'path',\n      id: this.getElementId(name),\n      name: name,\n      attrs: __assign({\n        size: size,\n        direction: direction,\n        path: [['M', x + size / 2, y], ['L', x, y + size], ['L', x + size, y + size], ['Z']],\n        cursor: 'pointer'\n      }, style)\n    });\n    shape.attr('matrix', getMatrixByAngle({\n      x: x + size / 2,\n      y: y + size / 2\n    }, ROTATE_MAP[direction]));\n    return shape;\n  };\n  /**\n   * 更新分页器 arrow 组件\n   */\n  Category.prototype.updateArrowPath = function (arrow, point) {\n    var x = point.x,\n      y = point.y;\n    var _a = arrow.attr(),\n      size = _a.size,\n      direction = _a.direction;\n    var matrix = getMatrixByAngle({\n      x: x + size / 2,\n      y: y + size / 2\n    }, ROTATE_MAP[direction]);\n    arrow.attr('path', [['M', x + size / 2, y], ['L', x, y + size], ['L', x + size, y + size], ['Z']]);\n    arrow.attr('matrix', matrix);\n  };\n  Category.prototype.getCurrentNavigationMatrix = function () {\n    var _a = this,\n      currentPageIndex = _a.currentPageIndex,\n      pageWidth = _a.pageWidth,\n      pageHeight = _a.pageHeight;\n    var layout = this.get('layout');\n    var translate = layout === 'horizontal' ? {\n      x: 0,\n      y: pageHeight * (1 - currentPageIndex)\n    } : {\n      x: pageWidth * (1 - currentPageIndex),\n      y: 0\n    };\n    return getMatrixByTranslate(translate);\n  };\n  // 附加状态对应的样式\n  Category.prototype.applyItemStates = function (item, subGroup) {\n    var states = this.getItemStates(item);\n    var hasStates = states.length > 0;\n    if (hasStates) {\n      var children = subGroup.getChildren();\n      var itemStates_1 = this.get('itemStates');\n      each(children, function (element) {\n        var name = element.get('name');\n        var elName = name.split('-')[2]; // marker, name, value\n        var statesStyle = getStatesStyle(item, elName, itemStates_1);\n        if (statesStyle) {\n          element.attr(statesStyle);\n          if (elName === 'marker' && !(element.get('isStroke') && element.get('isFill'))) {\n            // 如果 marker 是单填充或者单描边的话，就不要额外添加 stroke 或这 fill 属性，否则会影响 unchecked 后的显示\n            if (element.get('isStroke')) {\n              element.attr('fill', null);\n            }\n            if (element.get('isFill')) {\n              element.attr('stroke', null);\n            }\n          }\n        }\n      });\n    }\n  };\n  // 获取 itemWidth 的最终设置\n  Category.prototype.getLimitItemWidth = function () {\n    var itemWidth = this.get('itemWidth');\n    var maxItemWidth = this.get('maxItemWidth');\n    if (maxItemWidth) {\n      // 设置了最大宽度\n      if (itemWidth) {\n        maxItemWidth = itemWidth <= maxItemWidth ? itemWidth : maxItemWidth;\n      }\n    } else if (itemWidth) {\n      maxItemWidth = itemWidth;\n    }\n    return maxItemWidth;\n  };\n  return Category;\n}(LegendBase);\nexport default Category;","map":null,"metadata":{},"sourceType":"module"}