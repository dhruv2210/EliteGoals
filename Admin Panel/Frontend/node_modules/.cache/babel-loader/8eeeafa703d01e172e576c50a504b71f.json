{"ast":null,"code":"import { __extends } from \"tslib\";\nimport * as _ from '@antv/util';\nimport { GAP } from '../constant';\nimport Adjust from './adjust';\nfunction randomNumber(min, max) {\n  return (max - min) * Math.random() + min;\n}\nvar Jitter = /** @class */function (_super) {\n  __extends(Jitter, _super);\n  function Jitter() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  Jitter.prototype.process = function (groupDataArray) {\n    var groupedDataArray = _.clone(groupDataArray);\n    // 之前分组之后的数据，然后有合并回去（和分组前可以理解成是一样的）\n    var mergeData = _.flatten(groupedDataArray);\n    // 返回值\n    this.adjustData(groupedDataArray, mergeData);\n    return groupedDataArray;\n  };\n  /**\n   * 当前数据分组（index）中，按照维度 dim 进行 jitter 调整\n   * @param dim\n   * @param values\n   * @param dataArray\n   */\n  Jitter.prototype.adjustDim = function (dim, values, dataArray) {\n    var _this = this;\n    // 在每一个分组中，将数据再按照 dim 分组，用于散列\n    var groupDataArray = this.groupData(dataArray, dim);\n    return _.each(groupDataArray, function (data, dimValue) {\n      return _this.adjustGroup(data, dim, parseFloat(dimValue), values);\n    });\n  };\n  // 随机出来的字段值\n  Jitter.prototype.getAdjustOffset = function (range) {\n    var pre = range.pre,\n      next = range.next;\n    // 随机的范围\n    var margin = (next - pre) * GAP;\n    return randomNumber(pre + margin, next - margin);\n  };\n  // adjust group data\n  Jitter.prototype.adjustGroup = function (group, dim, dimValue, values) {\n    var _this = this;\n    // 调整范围\n    var range = this.getAdjustRange(dim, dimValue, values);\n    _.each(group, function (data) {\n      data[dim] = _this.getAdjustOffset(range); // 获取调整的位置\n    });\n\n    return group;\n  };\n  return Jitter;\n}(Adjust);\nexport default Jitter;","map":null,"metadata":{},"sourceType":"module"}