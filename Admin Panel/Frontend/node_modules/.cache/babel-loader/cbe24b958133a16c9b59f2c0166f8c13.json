{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createSensor = void 0;\nvar _debounce = _interopRequireDefault(require(\"../debounce\"));\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\n/**\n * Created by hustcc on 18/7/5.\n * Contract: i@hust.cc\n */\nvar createSensor = function createSensor(element) {\n  var sensor = undefined; // callback\n\n  var listeners = [];\n  /**\n   * trigger listeners\n   */\n\n  var resizeListener = (0, _debounce[\"default\"])(function () {\n    // trigger all\n    listeners.forEach(function (listener) {\n      listener(element);\n    });\n  });\n  /**\n   * create ResizeObserver sensor\n   * @returns\n   */\n\n  var newSensor = function newSensor() {\n    var s = new ResizeObserver(resizeListener); // listen element\n\n    s.observe(element); // trigger once\n\n    resizeListener();\n    return s;\n  };\n  /**\n   * listen with callback\n   * @param cb\n   */\n\n  var bind = function bind(cb) {\n    if (!sensor) {\n      sensor = newSensor();\n    }\n    if (listeners.indexOf(cb) === -1) {\n      listeners.push(cb);\n    }\n  };\n  /**\n   * destroy\n   */\n\n  var destroy = function destroy() {\n    sensor.disconnect();\n    listeners = [];\n    sensor = undefined;\n  };\n  /**\n   * cancel bind\n   * @param cb\n   */\n\n  var unbind = function unbind(cb) {\n    var idx = listeners.indexOf(cb);\n    if (idx !== -1) {\n      listeners.splice(idx, 1);\n    } // no listener, and sensor is exist\n    // then destroy the sensor\n\n    if (listeners.length === 0 && sensor) {\n      destroy();\n    }\n  };\n  return {\n    element: element,\n    bind: bind,\n    destroy: destroy,\n    unbind: unbind\n  };\n};\nexports.createSensor = createSensor;","map":null,"metadata":{},"sourceType":"script"}